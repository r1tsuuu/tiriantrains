{% extends "layouts/base.html" %}

{% block title %} Sell Ticket {% endblock %} 

{% block content %}

<main class="content">
    <div class="container-fluid p-0">
        <h1 class="h3 mb-3">Purchase Your Ticket</h1>

        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Select your ticket here</h5>
                    </div>
                    <div class="card-body">
                        
                        {% if msg %}
                            <div class="alert {% if success %}alert-success{% else %}alert-danger{% endif %} alert-dismissible" role="alert">
                                <div class="alert-message">
                                    {{ msg }}
                                </div>
                            </div>
                        {% endif %}

                        <form method="post" action="">
                            {% csrf_token %}
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Ticket ID</label>
                                    {{ form.ticket_id }} 
                                    <small class="form-text text-muted">Format: YYYYMMDDXXXX</small>
                                    <div class="text-danger">{{ form.ticket_id.errors }}</div>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Customer</label>
                                    {{ form.customer }}
                                    <div class="text-danger">{{ form.customer.errors }}</div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Purchase Date</label>
                                    {{ form.purchase_date }}
                                    <div class="text-danger">{{ form.purchase_date.errors }}</div>
                                </div>

                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Trip Date</label>
                                    {{ form.trip_date }}
                                    <div class="text-danger">{{ form.trip_date.errors }}</div>
                                </div>
                            </div>

                            <div class="mb-3 mt-4">
                                <label class="form-label h5">Select Trip</label>
                                <div class="table-responsive">
                                    <table class="table table-hover table-striped">
                                        <thead class="table-light">
                                            <tr>
                                                <th scope="col">Select</th>
                                                <th scope="col">Origin</th>
                                                <th scope="col">Destination</th>
                                                <th scope="col">Departure</th>
                                                <th scope="col">Arrival</th>
                                                <th scope="col">Cost</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for trip in trips %}
                                            <tr>
                                                <td>
                                                    <input class="form-check-input" type="radio" name="trips" value="{{ trip.pk }}" required>
                                                </td>
                                                <td>
                                                    {% if trip.route %}
                                                        {{ trip.route.origin.station_name }}
                                                    {% else %}
                                                        <span class="text-muted">N/A</span>
                                                    {% endif %}
                                                </td>
                                                <td>
                                                    {% if trip.route %}
                                                        {{ trip.route.destination.station_name }}
                                                    {% else %}
                                                        <span class="text-muted">N/A</span>
                                                    {% endif %}
                                                </td>
                                                <td>{{ trip.departure_time|time:"H:i" }}</td>
                                                <td>{{ trip.arrival_time|time:"H:i" }}</td>
                                                <td><strong>{{ trip.trip_cost }}</strong> Lion Coins</td>
                                            </tr>
                                            {% empty %}
                                            <tr>
                                                <td colspan="6" class="text-center">No trips available.</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                <div class="text-danger">{{ form.trips.errors }}</div>
                            </div>

                            <button type="submit" class="btn btn-primary btn-lg mt-3">Purchase Ticket</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<script>
    // Simple script to add Bootstrap class to Django form fields rendered by {{ form.field }}
    document.addEventListener("DOMContentLoaded", function() {
        var inputs = document.querySelectorAll('input[type="text"], input[type="date"], input[type="number"], select');
        inputs.forEach(function(input) {
            if (!input.classList.contains('form-control')) {
                input.classList.add('form-control');
            }
        });
    });
</script>

{% endblock content %}